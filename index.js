!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}([function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o={get type(){return"None"},map:function(){return o},ifPresent:function(){},flatMap:function(){return o},getOrElse:function(t){return t instanceof Function?t():t},equals:function(t){return"None"===t.type},toString:function(){return"None"},get present(){return!1}},i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.value=e}return r(t,[{key:"map",value:function(e){return new t(e(this.value))}},{key:"ifPresent",value:function(t){return this.map(t)}},{key:"flatMap",value:function(t){return this.map(t).getOrElse(o)}},{key:"getOrElse",value:function(){return this.value}},{key:"equals",value:function(e){return e instanceof t&&e.value===this.value}},{key:"toString",value:function(){return"Some("+this.value.toString()+")"}},{key:"present",get:function(){return!0}},{key:"type",get:function(){return"Some"}}]),t}();function a(t){return null!=t&&(t instanceof i||t===o||"Some"===t.type||"None"===t.type)}t.exports.Some=i,t.exports.None=o,t.exports.verifyIsOptional=function(t){if(null==t)throw new Error("Error: data is not Optional - it's null");if(!a(t))throw new Error("Error: data ("+t+") is not an Option!");if(a(t.value))throw new Error("Error: data ("+t.value.toString()+") is wrapped in Option twice")},t.exports.fromNullable=function(t){return null!=t?new i(t):o}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=n(6),c=function(){function t(){a(this,t)}return r(t,[{key:"toString",value:function(){return this.annotationType+"()"}}]),t}(),u=function(t){function e(){return a(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),e}(),p=function(t){function e(){return a(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),e}(),l=function(t){function e(){return a(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),e}(),d=function(t){function e(){return a(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),e}();function f(t){this.name=t}f.prototype.toString=function(){return'LocalOperationStart("'+this.name+'")'};var h=function(t){function e(){return a(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),e}();function v(t){this.message=t}function m(t){this.serviceName=t}function y(t){this.name=t}function g(t){var e=t.host,n=t.port;this.host=e,this.port=n}function S(t){var e=t.serviceName,n=t.host,r=t.port;this.serviceName=e,this.host=n||void 0,this.port=r||0}function w(t){var e=t.host,n=t.port;this.host=e||s.getLocalAddress(),this.port=n||0}function b(t,e){this.key=t,this.value=e}v.prototype.toString=function(){return'Message("'+this.message+'")'},m.prototype.toString=function(){return'ServiceName("'+this.serviceName+'")'},y.prototype.toString=function(){return'Rpc("'+this.name+'")'},g.prototype.toString=function(){return'ClientAddr(host="'+this.host+'", port='+this.port+")"},S.prototype.toString=function(){return'ServerAddr(serviceName="'+this.serviceName+'", host="'+this.host+'", port='+this.port+")"},w.prototype.toString=function(){return'LocalAddr(host="'+this.host.toString()+'", port='+this.port+")"},b.prototype.toString=function(){return"BinaryAnnotation("+this.key+'="'+this.value+'")'};var I={ClientSend:u,ClientRecv:p,ServerSend:l,ServerRecv:d,Message:v,ServiceName:m,Rpc:y,ClientAddr:g,ServerAddr:S,LocalAddr:w,BinaryAnnotation:b,LocalOperationStart:f,LocalOperationStop:h};Object.keys(I).forEach(function(t){I[t].prototype.annotationType=t}),t.exports=I},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(0),i=o.Some,a=o.None,s=o.verifyIsOptional,c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.traceId,r=void 0===n?a:n,o=e.parentId,i=void 0===o?a:o,c=e.spanId,u=e.sampled,p=void 0===u?a:u,l=e.flags,d=void 0===l?0:l;s(r),s(i),s(p),this._traceId=r,this._parentId=i,this._spanId=c,this._sampled=p,this._flags=d}return r(t,[{key:"isDebug",value:function(){return 1==(1&this._flags)}},{key:"toString",value:function(){return"TraceId(spanId="+this.spanId.toString()+", parentId="+this.parentId.toString()+", traceId="+this.traceId.toString()+")"}},{key:"spanId",get:function(){return this._spanId}},{key:"parentId",get:function(){return this._parentId.getOrElse(this.spanId)}},{key:"traceId",get:function(){return this._traceId.getOrElse(this.parentId)}},{key:"sampled",get:function(){return this.isDebug()?new i(!0):this._sampled}},{key:"flags",get:function(){return this._flags}}]),t}();t.exports=c},function(t,e,n){"use strict";function r(t){var e=t.serviceName,n=t.ipv4,r=t.port;this.setServiceName(e),this.setIpv4(n),this.setPort(r)}function o(t,e){this.timestamp=t,this.value=e}function i(t){var e=this;this.traceId=t.traceId,t._parentId.ifPresent(function(t){e.parentId=t}),this.id=t.spanId,this.name=void 0,this.kind=void 0,this.timestamp=void 0,this.duration=void 0,this.localEndpoint=void 0,this.remoteEndpoint=void 0,this.annotations=[],this.tags={},this.debug=t.isDebug(),this.shared=!1}r.prototype.setServiceName=function(t){this.serviceName=t?t.toLocaleLowerCase():void 0},r.prototype.setIpv4=function(t){this.ipv4=t},r.prototype.setPort=function(t){this.port=t||void 0},r.prototype.isEmpty=function(){return void 0===this.serviceName&&void 0===this.ipv4&&void 0===this.port},o.prototype.toString=function(){return'Annotation(value="'+this.value+'")'},i.prototype.setName=function(t){this.name=t?t.toLocaleLowerCase():void 0},i.prototype.setKind=function(t){this.kind=t},i.prototype.setTimestamp=function(t){this.timestamp=t},i.prototype.setDuration=function(t){void 0!==t&&(this.duration=Math.max(t,1))},i.prototype.setLocalEndpoint=function(t){t&&!t.isEmpty()?this.localEndpoint=t:this.localEndpoint=void 0},i.prototype.setRemoteEndpoint=function(t){t&&!t.isEmpty()?this.remoteEndpoint=t:this.remoteEndpoint=void 0},i.prototype.addAnnotation=function(t,e){this.annotations.push(new o(t,e))},i.prototype.putTag=function(t,e){this.tags[t]=e},i.prototype.setDebug=function(t){this.debug=t},i.prototype.setShared=function(t){this.shared=t},i.prototype.toString=function(){var t=this.annotations.map(function(t){return t.toString()}).join(", ");return"Span(id="+this.traceId+", annotations=["+t+"])"},t.exports.Endpoint=r,t.exports.Span=i},function(t,e,n){"use strict";t.exports={TraceId:"X-B3-TraceId",SpanId:"X-B3-SpanId",ParentSpanId:"X-B3-ParentSpanId",Sampled:"X-B3-Sampled",Flags:"X-B3-Flags"}},function(t,e,n){"use strict";var r=n(0),o=n(1),i=n(8),a=n(18),s=n(2),c=n(9),u=n(4),p=n(6),l=n(19),d=n(20),f=n(11),h=n(12),v=n(21),m=n(3),y=n(24);t.exports={Tracer:i,createNoopTracer:a,TraceId:s,option:r,Annotation:o,InetAddress:p,HttpHeaders:u,BatchRecorder:l,ConsoleRecorder:d,ExplicitContext:f,sampler:c,Request:h,Instrumentation:v,model:m,jsonEncoder:y}},function(t,e,n){"use strict";(function(e){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.addr=e}return r(t,[{key:"ipv4",value:function(){var t=this.toInt();if(t&&0!==t)return this.addr}},{key:"toInt",value:function(){var t=this.addr.split(".");return t[0]<<24|t[1]<<16|t[2]<<8|t[3]}},{key:"toString",value:function(){return"InetAddress("+this.addr+")"}}]),t}();o.getLocalAddress=function(){if(!("object"===(void 0===e?"undefined":n(e))&&"function"==typeof e.on))return new o("127.0.0.1");var t=!function(){var t=new Error('Cannot find module "."');throw t.code="MODULE_NOT_FOUND",t}().call(null,"network-address");return new o(t.ipv4())},t.exports=o}).call(e,n(7))},function(t,e){var n,r,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(t){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,u=[],p=!1,l=-1;function d(){p&&c&&(p=!1,c.length?u=c.concat(u):l=-1,u.length&&f())}function f(){if(!p){var t=s(d);p=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,p=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function v(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new h(t,e)),1!==u.length||p||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(0),i=o.None,a=o.Some,s=o.fromNullable,c=n(9),u=c.Sampler,p=c.alwaysSample,l=n(1),d=n(15),f=n(2),h=n(16),v=n(10),m=v.now,y=v.hrtime,g=n(3).Endpoint,S=n(17);function w(t){throw new Error("Tracer: Missing required argument "+t+".")}var b=function(){function t(e){var n=e.ctxImpl,r=void 0===n?w("ctxImpl"):n,o=e.recorder,i=void 0===o?w("recorder"):o,a=e.sampler,s=void 0===a?new u(p):a,c=e.traceId128Bit,l=void 0!==c&&c,d=e.localServiceName,f=e.localEndpoint;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.recorder=i,this.sampler=s,this.traceId128Bit=l,this._localEndpoint=f||new g({serviceName:d||"unknown"}),this._ctxImpl=r,this._defaultTraceId=this.createRootId(),this._startTimestamp=m(),this._startTick=y()}return r(t,[{key:"scoped",value:function(t){return this._ctxImpl.scoped(t)}},{key:"createRootId",value:function(){var t=h(),e=this.traceId128Bit?new a(h()+t):i,n=new f({traceId:e,parentId:i,spanId:t,sampled:i,flags:0});return n._sampled=this.sampler.shouldSample(n),n}},{key:"createChildId",value:function(){var t=s(this._ctxImpl.getContext()),e=new f({traceId:t.map(function(t){return t.traceId}),parentId:t.map(function(t){return t.spanId}),spanId:h(),sampled:t.flatMap(function(t){return t.sampled}),flags:t.map(function(t){return t.flags}).getOrElse(0)});return!1===e.sampled.present&&(e._sampled=this.sampler.shouldSample(e)),e}},{key:"local",value:function(t,e){var n=this;if("function"!=typeof e)throw new Error("you must pass a function");return this.scoped(function(){var r=n.createChildId();n.setId(r),n.recordServiceName(n._localEndpoint.serviceName),n.recordAnnotation(new l.LocalOperationStart(t));var o=void 0;try{o=e()}catch(t){throw n.recordBinary("error",t.message?t.message:t.toString()),n.recordAnnotation(new l.LocalOperationStop),t}if(!S(o))return n.recordAnnotation(new l.LocalOperationStop),o;if(!r.sampled.getOrElse(!1))return o;var i=function(t){return n.recorder.record(new d({traceId:r,timestamp:m(n._startTimestamp,n._startTick),annotation:t}))};return o.then(function(t){return i(new l.LocalOperationStop),t}).catch(function(t){var e=t.message?t.message:t.toString();throw i(new l.BinaryAnnotation("error",e)),i(new l.LocalOperationStop),t})})}},{key:"letChildId",value:function(t){var e=this;return this.scoped(function(){var n=e.createChildId();return e.setId(n),t(n)})}},{key:"setId",value:function(t){this._ctxImpl.setContext(t)}},{key:"recordAnnotation",value:function(t){var e=this;this.id.sampled.ifPresent(function(n){n&&e.recorder.record(new d({traceId:e.id,timestamp:m(e._startTimestamp,e._startTick),annotation:t}))})}},{key:"recordMessage",value:function(t){this.recordAnnotation(new l.Message(t))}},{key:"recordServiceName",value:function(t){this.recordAnnotation(new l.ServiceName(t))}},{key:"recordRpc",value:function(t){this.recordAnnotation(new l.Rpc(t))}},{key:"recordClientAddr",value:function(t){this.recordAnnotation(new l.ClientAddr(t))}},{key:"recordServerAddr",value:function(t){this.recordAnnotation(new l.ServerAddr(t))}},{key:"recordLocalAddr",value:function(t){this.recordAnnotation(new l.LocalAddr(t))}},{key:"recordBinary",value:function(t,e){this.recordAnnotation(new l.BinaryAnnotation(t,e))}},{key:"writeIdToConsole",value:function(t){console.log(t+": "+this.id.toString())}},{key:"id",get:function(){return this._ctxImpl.getContext()||this._defaultTraceId}},{key:"localEndpoint",get:function(){return this._localEndpoint}}]),t}();t.exports=b},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(0).Some,a=function(){function t(e){o(this,t),this.evaluator=e}return r(t,[{key:"shouldSample",value:function(t){var e=this,n=t.sampled.getOrElse(function(){return e.evaluator(t)});return new i(n)}},{key:"toString",value:function(){return"Sampler("+this.evaluator.toString()+")"}}]),t}();function s(t){return!1}function c(t){return!0}s.toString=function(){return"never sample"},c.toString=function(){return"always sample"};var u=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return o(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,function(t){if(t<=0)return s;if(t>=1)return c;var e=0,n=parseInt(1/t),r=function(t){var r=0==(e%=n);return e++,r};return r.toString=function(){return"countingSampler: sampleRate="+t},r}(t<1?t:1)))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a),e}();t.exports={Sampler:a,CountingSampler:u,neverSample:s,alwaysSample:c}},function(t,e,n){"use strict";(function(e){var n=void 0!==e&&e.hrtime;t.exports.now=n?function(t,n){if(t&&n){var r=e.hrtime(n);return t+Math.floor(1e6*r[0]+r[1]/1e3)}return 1e3*Date.now()}:function(){return 1e3*Date.now()},t.exports.hrtime=n?function(){return e.hrtime()}:function(){}}).call(e,n(7))},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.currentCtx=null}return r(t,[{key:"setContext",value:function(t){this.currentCtx=t}},{key:"getContext",value:function(){return this.currentCtx}},{key:"scoped",value:function(t){var e=this.currentCtx,n=t();return this.currentCtx=e,n}},{key:"letContext",value:function(t,e){var n=this;return this.scoped(function(){return n.setContext(t),e()})}}]),t}()},function(t,e,n){"use strict";var r=n(4);t.exports={addZipkinHeaders:function(t,e){var n=function(t,e){var n=t.headers||{};return n[r.TraceId]=e.traceId,n[r.SpanId]=e.spanId,e._parentId.ifPresent(function(t){n[r.ParentSpanId]=t}),e.sampled.ifPresent(function(t){n[r.Sampled]=t?"1":"0"}),n}(t,e);return Object.assign({},t,{headers:n})}}},function(t,e,n){const r=n(5),o=n(25),{Instrumentation:i}=r;t.exports.wrapRequest=function({tracer:t,serviceName:e,remoteServiceName:n}){const r=new i.HttpClient({tracer:t,serviceName:e,remoteServiceName:n});return function(e){t.scoped(()=>{const n=e.method||"GET",o=r.recordRequest(e,e.url,n),i=t.id;o.header=Object.assign({},o.header,o.headers);const{success:a,fail:s}=o,c=Object.assign({},o,{success(e){t.scoped(()=>{r.recordResponse(i,e.statusCode)}),a(e)},fail(e){t.scoped(()=>{r.recordError(i,e)}),s(e)}});wx.request(c)})}},t.exports.zipkin=Object.assign({},r,{HttpLogger:o})},function(t,e){function n(t){throw new Error("Cannot find module '"+t+"'.")}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=14},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=function(){function t(e){var n=e.traceId,r=e.timestamp,o=e.annotation;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.traceId=n,this.timestamp=r,this.annotation=o}return r(t,[{key:"toString",value:function(){return"Record(traceId="+this.traceId.toString()+", annotation="+this.annotation.toString()+")"}}]),t}();t.exports=o},function(t,e,n){"use strict";t.exports=function(){for(var t="",e=0;e<16;e++)t+="0123456789abcdef"[Math.floor(16*Math.random())];return t}},function(t,e){t.exports=function(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}},function(t,e,n){"use strict";var r=n(8),o=n(11);t.exports=function(){var t=new o;return new r({recorder:{record:function(){}},ctxImpl:t})}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(10),i=o.now,a=o.hrtime,s=n(3),c=s.Span,u=s.Endpoint;function p(t){this.traceId=t,this.startTimestamp=i(),this.startTick=a(),this.delegate=new c(t),this.localEndpoint=new u({})}p.prototype.finish=function(){this.endTimestamp||(this.endTimestamp=i(this.startTimestamp,this.startTick))};var l=function(){function t(e){var n=this,r=e.logger,o=e.timeout,i=void 0===o?6e7:o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.logger=r,this.timeout=i,this.partialSpans=new Map;var a=setInterval(function(){n.partialSpans.forEach(function(t,e){n._timedOut(t)&&n._writeSpan(e)})},1e3);a.unref&&a.unref()}return r(t,[{key:"_writeSpan",value:function(t){var e=this.partialSpans.get(t);if(void 0!==e){this.partialSpans.delete(t);var n=e.delegate;n.setLocalEndpoint(e.localEndpoint),e.endTimestamp&&(n.setTimestamp(e.startTimestamp),n.setDuration(e.endTimestamp-e.startTimestamp)),this.logger.logSpan(n)}}},{key:"_updateSpanMap",value:function(t,e){var n=void 0;e(n=this.partialSpans.has(t)?this.partialSpans.get(t):new p(t)),n.endTimestamp?this._writeSpan(t):this.partialSpans.set(t,n)}},{key:"_timedOut",value:function(t){return t.startTimestamp+this.timeout<i()}},{key:"record",value:function(t){var e=t.traceId;this._updateSpanMap(e,function(n){switch(t.annotation.annotationType){case"ClientSend":n.delegate.setKind("CLIENT");break;case"ClientRecv":n.finish(),n.delegate.setKind("CLIENT");break;case"ServerSend":n.finish(),n.delegate.setKind("SERVER");break;case"ServerRecv":n.delegate.setShared(e.parentId!==e.spanId),n.delegate.setKind("CLIENT");break;case"LocalOperationStart":n.delegate.setName(t.annotation.name);break;case"LocalOperationStop":n.finish();break;case"Message":n.delegate.addAnnotation(t.timestamp,t.annotation.message);break;case"Rpc":n.delegate.setName(t.annotation.name);break;case"ServiceName":n.localEndpoint.setServiceName(t.annotation.serviceName);break;case"BinaryAnnotation":n.delegate.putTag(t.annotation.key,t.annotation.value);break;case"LocalAddr":n.localEndpoint.setIpv4(t.annotation.host&&t.annotation.host.ipv4()),n.localEndpoint.setPort(t.annotation.port);break;case"ServerAddr":n.delegate.setKind("CLIENT"),n.delegate.setRemoteEndpoint(new u({serviceName:t.annotation.serviceName,ipv4:t.annotation.host&&t.annotation.host.ipv4(),port:t.annotation.port}))}})}},{key:"toString",value:function(){return"BatchRecorder()"}}]),t}();t.exports=l},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:console.log;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.logger=e}return r(t,[{key:"record",value:function(t){var e=t.traceId;this.logger("Record at (spanId="+e.spanId+", parentId="+e.parentId+", traceId="+e.traceId+"): "+t.annotation.toString())}},{key:"toString",value:function(){return"consoleTracer"}}]),t}();t.exports=o},function(t,e,n){"use strict";var r=n(22),o=n(23);t.exports={HttpServer:r,HttpClient:o}},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(4),i=n(0),a=i.Some,s=i.None,c=n(2),u=n(1);function p(t){return"1"===t||"true"===t}function l(t){try{return new a(parseInt(t))}catch(t){return s}}function d(t){throw new Error("HttpServerInstrumentation: Missing required argument "+t+".")}var f=function(){function t(e){var n=e.tracer,r=void 0===n?d("tracer"):n,o=e.serviceName,i=void 0===o?r.localEndpoint.serviceName:o,a=e.port,s=void 0===a?d("port"):a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tracer=r,this.serviceName=i,this.port=s}return r(t,[{key:"_createIdFromHeaders",value:function(t){if(function(t){return t(o.TraceId)!==s&&t(o.SpanId)!==s}(t))return t(o.SpanId).map(function(e){var n=t(o.TraceId),r=t(o.ParentSpanId),i=t(o.Sampled),a=t(o.Flags).flatMap(l).getOrElse(0);return new c({traceId:n,parentId:r,spanId:e,sampled:i.map(p),flags:a})});if(t(o.Flags)!==s){var e=this.tracer.id,n=new c({traceId:e.traceId,parentId:e.parentId,spanId:e.spanId,sampled:e.sampled,flags:t(o.Flags)});return new a(n)}return new a(this.tracer.createRootId())}},{key:"recordRequest",value:function(t,e,n){var r=this;this._createIdFromHeaders(n).ifPresent(function(t){return r.tracer.setId(t)});var i=this.tracer.id;return this.tracer.recordServiceName(this.serviceName),this.tracer.recordRpc(t.toUpperCase()),this.tracer.recordBinary("http.url",e),this.tracer.recordAnnotation(new u.ServerRecv),this.tracer.recordAnnotation(new u.LocalAddr({port:this.port})),0!==i.flags&&null!=i.flags&&this.tracer.recordBinary(o.Flags,i.flags.toString()),i}},{key:"recordResponse",value:function(t,e,n){this.tracer.setId(t),this.tracer.recordBinary("http.status_code",e.toString()),n&&this.tracer.recordBinary("error",n.toString()),this.tracer.recordAnnotation(new u.ServerSend)}}]),t}();t.exports=f},function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o=n(1),i=n(12);var a=function(){function t(e){var n=e.tracer,r=void 0===n?function(t){throw new Error("HttpClientInstrumentation: Missing required argument "+t+".")}("tracer"):n,o=e.serviceName,i=void 0===o?r.localEndpoint.serviceName:o,a=e.remoteServiceName;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tracer=r,this.serviceName=i,this.remoteServiceName=a}return r(t,[{key:"recordRequest",value:function(t,e,n){this.tracer.setId(this.tracer.createChildId());var r=this.tracer.id;return this.tracer.recordServiceName(this.serviceName),this.tracer.recordRpc(n.toUpperCase()),this.tracer.recordBinary("http.url",e),this.tracer.recordAnnotation(new o.ClientSend),this.remoteServiceName&&this.tracer.recordAnnotation(new o.ServerAddr({serviceName:this.remoteServiceName})),i.addZipkinHeaders(t,r)}},{key:"recordResponse",value:function(t,e){this.tracer.setId(t),this.tracer.recordBinary("http.status_code",e.toString()),this.tracer.recordAnnotation(new o.ClientRecv)}},{key:"recordError",value:function(t,e){this.tracer.setId(t),this.tracer.recordBinary("error",e.toString()),this.tracer.recordAnnotation(new o.ClientRecv)}}]),t}();t.exports=a},function(t,e,n){"use strict";function r(t){if(void 0!==t){var e={serviceName:t.serviceName||""};return t.ipv4&&(e.ipv4=t.ipv4),t.port&&(e.port=t.port),e}}t.exports.JSON_V1={encode:function(t){return function(t){var e={traceId:t.traceId};t.parentId&&(e.parentId=t.parentId),e.id=t.id,e.name=t.name||"",t.shared||(e.timestamp=t.timestamp,e.duration=t.duration);var n=r(t.localEndpoint),o=void 0,i=void 0,a=void 0;switch(t.kind){case"CLIENT":o=t.timestamp?"cs":void 0,i="cr",a="sa";break;case"SERVER":o=t.timestamp?"sr":void 0,i="ss",a="ca"}(t.annotations.length>0||o)&&(e.annotations=t.annotations.map(function(t){return function(t,e){return{value:t.value,timestamp:t.timestamp,endpoint:e}}(t,n)})),o&&(e.annotations.push({value:o,timestamp:t.timestamp,endpoint:n}),t.duration&&e.annotations.push({value:i,timestamp:t.timestamp+t.duration,endpoint:n}));var s=Object.keys(t.tags);if((s.length>0||t.remoteEndpoint)&&(e.binaryAnnotations=s.map(function(e){return{key:e,value:t.tags[e],endpoint:n}})),t.remoteEndpoint){var c={key:a,value:!0,endpoint:r(t.remoteEndpoint)};e.binaryAnnotations.push(c)}return t.debug&&(e.debug=!0),JSON.stringify(e)}(t)}},t.exports.JSON_V2={encode:function(t){return function(t){var e={traceId:t.traceId};return t.parentId&&(e.parentId=t.parentId),e.id=t.id,t.name&&(e.name=t.name),t.kind&&(e.kind=t.kind),t.timestamp&&(e.timestamp=t.timestamp),t.duration&&(e.duration=t.duration),t.localEndpoint&&(e.localEndpoint=t.localEndpoint),t.remoteEndpoint&&(e.remoteEndpoint=t.remoteEndpoint),t.annotations.length>0&&(e.annotations=t.annotations),Object.keys(t.tags).length>0&&(e.tags=t.tags),t.debug&&(e.debug=!0),t.shared&&(e.shared=!0),JSON.stringify(e)}(t)}}},function(t,e,n){const{jsonEncoder:{JSON_V1:r}}=n(5);t.exports=class{constructor({endpoint:t,headers:e={},httpInterval:n=1e3,jsonEncoder:o=r,timeout:i=0}){this.queue=[],this.endpoint=t,this.jsonEncoder=o,this.headers=Object.assign({"content-type":"application/json"},e),this.timeout=i,this.timer=setInterval(this.processQueue.bind(this),n)}logSpan(t){this.queue.push(this.jsonEncoder.encode(t))}processQueue(){if(this.queue.length>0){const t=`[${this.queue.join(",")}]`;wx.request({method:"POST",url:this.endpoint,data:t,header:this.headers,timeout:this.timeout,success(t){202!==t.statusCode&&console.error("Unexpected response while sending Zipkin data, status:"+`${t.statusCode}, body: ${t.data}`)},fail(t){console.error("Error sending Zipkin data",t)}}),this.queue.length=0}}}}])});